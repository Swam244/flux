# =============================================================================
# Flux Configuration
# =============================================================================
# This file configures the Flux rate limiter.
# Works with Django, FastAPI, Flask, or any Python application.

# -----------------------------------------------------------------------------
# Redis Connection Settings
# -----------------------------------------------------------------------------
[redis]
host = "127.0.0.1"
port = 6379
pool_size = 5
timeout_ms = 200

# -----------------------------------------------------------------------------
# Flux Core Settings
# -----------------------------------------------------------------------------
[flux]
key_prefix = "flux:"
log_file = "flux_debug.log"
fail_silently = true        # If true, allow requests when Redis is down
console_logging = false     # If true, enable console logging

# Analytics Settings
[analytics]
enabled = true
port = 4444
stream = "flux:events"
retention = 100000
sample_rate = 0.25       # 1.0 = 100% of requests, 0.1 = 10%


# Jitter helps prevent thundering herd by adding random variance to Retry-After
jitter_enabled = false      # Disabled by default
jitter_max_ms = 1000        # Max jitter to add in milliseconds (if enabled)

# -----------------------------------------------------------------------------
# Default Rate Limiting Settings
# -----------------------------------------------------------------------------
# These are used when creating a RateLimiter() without explicit parameters.
#
# Supported policies:
#   - "gcra"          : Generic Cell Rate Algorithm (smooth, recommended)
#   - "token_bucket"  : Token Bucket (bursty traffic)
#   - "leaky_bucket"  : Leaky Bucket (smooth output)
#   - "fixed_window"  : Fixed Window / FCFS (simple, but can have burst at window edges)

[rate_limit]
policy = "gcra"
requests = 100          # Requests per period
period = 60             # Period in seconds
burst = 10              # Burst capacity (optional, defaults to requests)

# -----------------------------------------------------------------------------
# Named Rate Limit Configurations
# -----------------------------------------------------------------------------
# Define presets for different application parts.
# Usage: @rate_limit(name="api", key=...)
#
# Example:
#   [rate_limits.api]
#   requests = 1000
#   period = 60

[rate_limits.default]
requests = 100
period = 60
policy = "gcra"

[rate_limits.strict]
requests = 5
period = 60
policy = "token_bucket"

[rate_limits.high_throughput]
requests = 10000
period = 60
policy = "gcra"
